# ğŸ¨ Color Palette Generator API

> A production-ready Express.js API for generating beautiful color palettes with built-in monitoring, security, and DevSecOps best practices.

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Node](https://img.shields.io/badge/node-%3E%3D14.0.0-brightgreen.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

## âœ¨ Features

- ğŸ¨ **Dynamic Color Generation** - Generate warm or cool color palettes based on version
- ğŸ“Š **Prometheus Metrics** - Built-in monitoring and observability
- ğŸ”’ **Security First** - Rate limiting, input validation, and CORS support
- ğŸš€ **Production Ready** - Health checks, graceful shutdown, and error handling
- ğŸ¯ **Canary Deployments** - Visual version differentiation (v1: warm colors, v2: cool colors)
- ğŸ’» **Beautiful UI** - Interactive web interface with copy-to-clipboard functionality

## ğŸš€ Quick Start

### Prerequisites

- Node.js 14.x or higher
- npm or yarn

### Installation

```bash
# Clone the repository
git clone <your-repo-url>
cd app/service

# Install dependencies
npm install

# Start the server
npm start
```

The server will start on `http://localhost:8080`

### Using Docker

```bash
# Build the image
docker build -t color-palette-api .

# Run the container
docker run -p 8080:8080 color-palette-api
```

## ğŸ“– API Documentation

### Endpoints

#### `GET /`
Returns an interactive HTML interface for generating and viewing color palettes.

**Response:** HTML page with color palette visualization

---

#### `GET /api`
Returns a JSON representation of the color palette.

**Response:**
```json
{
  "version": "v1",
  "palette": [
    "hsl(0, 75.2%, 58.3%)",
    "hsl(15, 72.1%, 61.2%)",
    "hsl(30, 78.5%, 55.7%)",
    "hsl(45, 73.8%, 62.4%)",
    "hsl(350, 76.3%, 59.1%)"
  ],
  "timestamp": "2025-12-08T10:30:00.000Z",
  "message": "Palette generated by v1",
  "theme": "warm"
}
```

---

#### `POST /palette`
Generate a custom palette with an optional seed color.

**Request Body:**
```json
{
  "seedColor": "#FF5733"
}
```

**Response:**
```json
{
  "version": "v1",
  "palette": ["hsl(...)", "hsl(...)", ...],
  "seedColor": "#FF5733",
  "timestamp": "2025-12-08T10:30:00.000Z"
}
```

---

#### `GET /health`
Health check endpoint for monitoring systems.

**Response:**
```json
{
  "status": "healthy",
  "version": "v1",
  "timestamp": "2025-12-08T10:30:00.000Z"
}
```

---

#### `GET /ready`
Readiness probe for Kubernetes/container orchestration.

**Response:**
```json
{
  "status": "ready",
  "version": "v1"
}
```

---

#### `GET /metrics`
Prometheus metrics endpoint.

**Response:** Prometheus-formatted metrics including:
- `http_request_duration_seconds` - Request latency histogram
- `http_requests_total` - Total HTTP requests counter
- `color_palettes_generated_total` - Total palettes generated
- Node.js default metrics (memory, CPU, etc.)

---

#### `GET /version`
Returns application version and runtime information.

**Response:**
```json
{
  "version": "v1",
  "node": "v18.17.0",
  "uptime": 3600.5
}
```

---

#### `GET /error`
Simulates an error for testing rollback scenarios.

**Response:** 500 error with intentional failure message

## ğŸ›¡ï¸ Security Features

### Rate Limiting
- **Limit:** 100 requests per minute per IP
- **Monitoring endpoints excluded:** `/health`, `/ready`, `/metrics` are not rate-limited
- **Response:** 429 Too Many Requests when limit exceeded

### Input Validation
- Validates and sanitizes all user inputs
- Protects against SQL injection attempts
- Prevents XSS attacks
- Rejects malicious patterns (`DROP`, `DELETE`, `<script>`, etc.)

### CORS
- Enabled by default for cross-origin requests
- Configurable headers for specific domains

## ğŸ“Š Monitoring & Observability

### Prometheus Integration

The `/metrics` endpoint exposes:
- HTTP request duration histograms
- Request counters by method, route, and status
- Custom business metrics (palettes generated)
- Node.js runtime metrics

Example Prometheus query:
```promql
# Request rate
rate(http_requests_total[5m])

# 95th percentile latency
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))

# Palette generation rate by version
rate(color_palettes_generated_total[5m])
```

### Health Checks

Configure your orchestrator to use:
- **Liveness probe:** `GET /health`
- **Readiness probe:** `GET /ready`

## ğŸ§ª Testing

```bash
# Run all tests
npm test

# Run tests with coverage
npm run test:coverage

# Run tests in watch mode
npm run test:watch
```

### Test Coverage

- âœ… Unit tests for all endpoints
- âœ… Integration tests for request lifecycle
- âœ… Security validation tests
- âœ… Rate limiting verification
- âœ… CORS functionality
- âœ… Error handling scenarios
- âœ… Performance benchmarks

## ğŸ”§ Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | `8080` | Server port |
| `APP_VERSION` | `v1` | Application version (v1=warm, v2=cool colors) |
| `NODE_ENV` | `production` | Environment mode |

### Example

```bash
PORT=3000 APP_VERSION=v2 npm start
```

## ğŸ¯ DevSecOps Features

### Canary Deployments
- **v1 (warm):** Red, orange, yellow color palettes
- **v2 (cool):** Blue, green, purple color palettes
- Visual differentiation makes canary testing obvious

### Graceful Shutdown
- Handles `SIGTERM` and `SIGINT` signals
- Completes in-flight requests before shutdown
- 10-second timeout for forced shutdown

### Logging
- Request logging with timestamps
- Error logging with stack traces (development mode)
- Version information in all logs

## ğŸ“ Project Structure

```
app/service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js           # Main application file
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ server.test.js  # Test suite
â”œâ”€â”€ package.json
â”œâ”€â”€ Dockerfile              # Container configuration
â””â”€â”€ README.md
```

## ğŸ§ª Security Testing

### Testing Injection Vulnerabilities

The API includes intentional security validation for testing purposes. Here's how to test various injection scenarios:

#### SQL Injection Tests

```bash
# Test 1: DROP TABLE attempt
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "DROP TABLE users"}'

# Expected Response: 400 Bad Request
# {"error": "Invalid input detected", "version": "v1"}

# Test 2: DELETE statement
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "test; DELETE FROM colors"}'

# Expected Response: 400 Bad Request
```

#### XSS (Cross-Site Scripting) Tests

```bash
# Test 1: Script tag injection
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "<script>alert(\"xss\")</script>"}'

# Expected Response: 400 Bad Request
# {"error": "Invalid input detected", "version": "v1"}

# Test 2: Event handler injection
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "<img src=x onerror=alert(1)>"}'

# Expected Response: 400 Bad Request
```

#### SQL Comment Injection

```bash
# Test: Comment-based bypass
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "red -- comment"}'

# Expected Response: 400 Bad Request
```

#### Valid Input Tests

```bash
# Test 1: Valid hex color
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "#FF5733"}'

# Expected Response: 200 OK
# {"version": "v1", "palette": [...], "seedColor": "#FF5733", ...}

# Test 2: Valid RGB notation
curl -X POST http://localhost:8080/palette \
  -H "Content-Type: application/json" \
  -d '{"seedColor": "rgb(255, 87, 51)"}'

# Expected Response: 200 OK
```

### Rate Limiting Tests

```bash
# Test rate limiting (100 requests/minute)
for i in {1..105}; do
  curl -s http://localhost:8080/api > /dev/null
  echo "Request $i"
done

# Expected: First 100 succeed, subsequent requests return 429
```

### Automated Security Testing

Run the full security test suite:

```bash
# Run security-focused tests
npm test -- --testNamePattern="Security Tests"

# Run injection validation tests
npm test -- --testNamePattern="POST /palette"
```

### SAST/DAST Integration

The `unsafeColorValidation` function is designed to be detected by:
- **SAST tools** (Snyk, SonarQube, Semgrep)
- **DAST tools** (OWASP ZAP, Burp Suite)
- **Dependency scanners** (npm audit, Dependabot)

Example scan commands:

```bash
# npm audit for dependency vulnerabilities
npm audit

# Using Snyk
snyk test

# Using SonarQube scanner
sonar-scanner
```
---
